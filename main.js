require("v8-compile-cache");const{app:app,shell:shell,clipboard:clipboard,dialog:dialog,BrowserWindow:BrowserWindow,screen:screen}=require("electron"),prompt=require("electron-prompt"),discord=require("discord-rpc"),Store=require("electron-store"),config=new Store,OS=require("os"),shortcut=require("electron-localshortcut");function init(){DiscordRPC(),createInitWindow("./index.html",!0,1.2,!0)}function DiscordRPC(){const e=new discord.Client({transport:"ipc"});e.isConnected=!1,e.login({clientId:"750116161890287657"}),e.on("ready",()=>{0===activity&&e.setActivity({state:"Playing Venge.io!",details:"NeXi-Client",startTimestamp:new Date,largeImageKey:"nexi-old"})})}function createInitWindow(e,t,n,i){const{width:o,height:l}=screen.getPrimaryDisplay().workAreaSize;let a=new BrowserWindow({width:o*n,height:l*n,show:!1});a.setFullScreen(t),a.setTitle("NeXi-Client V1.2.8+ BETA"),a.once("ready-to-show",()=>a.show()),-1!==e.indexOf("https://")?a.loadURL(e):a.loadFile(e),a.removeMenu(),function(e){String.prototype.isGame=function(){return/index.html/.test(this,"")},String.prototype.isSocial=function(){return/https:\/\/social.venge.io\//.test(this,"")};let t=(e,t)=>{e.preventDefault(),t.isGame()?a.loadURL(t):t.isSocial()?createInitWindow(t,!1,.9,!1):shell.openExternal(t)};e.webContents.on("new-window",t),e.webContents.on("will-navigate",t)}(a),shortcut.register(a,"F1",()=>{if(i)a.loadFile("./index.html");else{let e=a.webContents.getURL();a.loadURL(e)}}),i&&shortcut.register(a,"F2",()=>{console.log("Linkbox has been opened"),function(){function e(e){var t=prompt({title:e,label:"Please enter your Invite link here",value:i,inputAttrs:{type:"url"},type:"input"});return t}function t(){const e=dialog.showMessageBoxSync(a,{type:"question",buttons:["Play","Spectate"],title:"Join",message:"Would you like to spectate or play?",defaultId:0,cancelId:3});return e}function n(e,t){let n=e,i=n.split("#"),o=i[i.length-1],l=a.webContents.getURL(),c=l.split("/");c[c.length-1]=t?`index.html#Spectate:${o}`:`index.html#${o}`;let s=c.join("/");console.log(s),a.loadURL(s)}let i=clipboard.readText();if(-1===i.indexOf("venge.io/#")){i="https://venge.io/#00000";let o=t();0===o?e("Play").then(e=>{n(e,!1)}):1===o&&e("Spectate").then(e=>{n(e,!0)})}else{let e=t();0===e?n(i,!1):2!==e&&n(i,!0)}}()}),shortcut.register(a,"Alt+F4",()=>{a.webContents.executeJavaScript(onbeforeunload=null),console.log("Quit has been used"),i?app.quit():a.close()}),shortcut.register(a,"Ctrl+F5",()=>{a.webContents.reloadIgnoringCache()}),shortcut.register(a,"F9",()=>{a.webContents.openDevTools(),console.log("DevTools opened")}),shortcut.register(a,"F11",()=>{a.setSimpleFullScreen(!a.isSimpleFullScreen())}),shortcut.register(a,"ESCAPE",()=>{a.webContents.executeJavaScript("\n                  document.exitPointerLock = document.exitPointerLock || document.mozExitPointerLock;\n                  document.exitPointerLock();\n\t\t")}),shortcut.register(a,"=",()=>{createInitWindow("https://social.venge.io",!1,.9,!1)}),shortcut.register(a,"TAB",()=>{!function(){0===dialog.showMessageBoxSync(a,{type:"question",buttons:["General"],title:"Settings",message:"",defaultId:0,cancelId:2})&&0===dialog.showMessageBoxSync(a,{type:"question",buttons:["Disable FPS"],title:"Settings",message:"",defaultId:0,cancelId:1})&&(config.get("utilities_FPS",!0)?config.set("utilities_FPS",!1):config.set("utilities_FPS",!0),app.relaunch(),app.quit())}()}),a.webContents.on("will-prevent-unload",e=>{a.webContents.executeJavaScript("\n\t\tonbeforeunload = null;\n\t\t"),e.preventDefault()})}config.get("utilities_FPS")&&(-1!=OS.cpus().findIndex(e=>e.model.includes("AMD"))&&app.commandLine.appendSwitch("enable-zero-copy"),app.commandLine.appendSwitch("disable-frame-rate-limit")),config.get("utilities_useD3D11OND12")&&(app.commandLine.appendSwitch("use-angle","d3d11ond12"),app.commandLine.appendSwitch("enable-webgl2-compute-context")),app.commandLine.appendSwitch("enable-quic"),app.commandLine.appendSwitch("ignore-gpu-blacklist"),app.commandLine.appendSwitch("disable-gpu-vsync"),app.commandLine.appendSwitch("enable-pointer-lock-options"),app.commandLine.appendSwitch("disable-accelerated-video-decode",!1),app.commandLine.appendSwitch("autoplay-policy","no-user-gesture-required"),app.commandLine.appendSwitch("enable-quic"),app.commandLine.appendSwitch("high-dpi-support",1),app.on("ready",init);
